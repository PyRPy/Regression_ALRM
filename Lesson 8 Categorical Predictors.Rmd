---
title: "Lesson 8: Categorical Predictors"
output: html_notebook
editor_options: 
  chunk_output_type: console
---
# Birthweight and smoking (2-level categorical predictor, additive model)
https://onlinecourses.science.psu.edu/stat501/node/426/
* Load the birthsmokers data.
* Create a scatterplot matrix of the data
* Fit a multiple linear regression model of Wgt on Gest + Smoke.
* Display scatterplot of Wgt vs Gest with points marked by Smoke and add parallel regression lines representing Smoke=0 and Smoke=1.
* Display regression results and calculate confidence intervals for the regression parameters.
* Display confidence intervals for expected Wgt at Gest=38 (for Smoke=1 and Smoke=0).
* Repeat analysis separately for Smoke=0 and Smoke=1.
* Repeat analysis using (1, -1) coding.

```{r message=FALSE, warning=FALSE}
birthsmokers <- read.csv("DataL8/birthsmokers.csv", header=T)
attach(birthsmokers)
head(birthsmokers)
# str(birthsmokers)
birthsmokers$Smoke <- as.factor(birthsmokers$Smoke)
str(birthsmokers)
pairs(cbind(Wgt, Gest, Smoke))
# head(birthsmokers)
```
Build linear model as follows :
```{r}
model <- lm(Wgt ~ Gest + Smoke)

plot(x=Gest, y=Wgt, ylim=c(2300, 3700), 
     col=ifelse(Smoke==1, "red", "blue"),
     panel.last = c(lines(sort(Gest[Smoke==0]),
                          fitted(model)[Smoke==0][order(Gest[Smoke==0])],
                          col="blue"),
                    lines(sort(Gest[Smoke==1]),
                          fitted(model)[Smoke==1][order(Gest[Smoke==1])],
                          col="red")))
```
```{r}
summary(model)
```
```{r}
confint(model)
```
```{r}
predict(model, interval="confidence",
        newdata=data.frame(Gest=c(38, 38), Smoke=c(1, 0)))
```
To investigate the 'non-smoker' as subset in the linear model
```{r}
model.0 <- lm(Wgt ~ Gest, subset=Smoke==0) # changed to '0' from "no"
summary(model.0)
```
```{r}
predict(model.0, interval="confidence",
        newdata=data.frame(Gest=38))
```
To investigate the 'smoker' as subset in the linear model
```{r}
model.1 <- lm(Wgt ~ Gest, subset=Smoke==1) # changed to 1 from 'Yes'
summary(model.1)
```
```{r}
predict(model.1, interval="confidence",
        newdata=data.frame(Gest=38))
```
```{r}
Smoke2 <- ifelse(Smoke=="yes", 1, -1)
model.3 <- lm(Wgt ~ Gest + Smoke2)
summary(model.3)
detach(birthsmokers)
```
# Depression treatments (3-level categorical predictor, interaction model)

Load the depression data.
```{r}
depression <- read.table("DataL8/depression.txt", header=T)
attach(depression)
head(depression)
```
Display scatterplot of y (treatment effectiveness) vs age with points marked by treatment.
```{r}
with(data=depression, 
plot(x=age, y=y, col=as.numeric(TRT)),
legend("topleft", col=1:3, pch=1,
       inset=0.02, x.intersp = 1.5, y.intersp = 1.8,
       legend=c("Trt A", "Trt B", "Trt C"))
)
```
Create interaction variables and fit a multiple linear regression model of y on age + x2 + x3 + age.x2 + age.x3.
```{r}
age.x2 <- age*x2
age.x3 <- age*x3

model.1 <- lm(y ~ age + x2 + x3 + age.x2 + age.x3, data = depression) # add data=
summary(model.1)
# using attach () and detach may cause confusions and trouble
```
Add non-parallel regression lines representing each of the three treatments to the scatterplot.
```{r}
with(data=depression, 
plot(x=age, y=y, ylim=c(20, 80), col=as.numeric(TRT),
     panel.last = c(lines(sort(age[TRT=="A"]),
                          fitted(model.1)[TRT=="A"][order(age[TRT=="A"])],
                          col=1),
                    lines(sort(age[TRT=="B"]),
                          fitted(model.1)[TRT=="B"][order(age[TRT=="B"])],
                          col=2),
                    lines(sort(age[TRT=="C"]),
                          fitted(model.1)[TRT=="C"][order(age[TRT=="C"])],
                          col=3))), 
legend("topleft", col=1:3, pch=1, lty=1,
       inset=0.02, x.intersp = 1.5, y.intersp = 1.8,
       legend=c("Trt A", "Trt B", "Trt C"))
)
```
Display a residuals vs fits plot and a normal probability plot of the residuals, and conduct an Anderson-Darling normality test using the nortest package.
```{r}
plot(x=fitted(model.1), y=rstudent(model.1),
     panel.last = abline(h=0, lty=2))

qqnorm(residuals(model.1), main="", datax=TRUE)
qqline(residuals(model.1), datax=TRUE)

library(nortest)
ad.test(residuals(model.1)) # A = 0.40575, p-value = 0.3345
```
Conduct an F-test to see if at least one of x2, x3, age.x2, and age.x3 are useful (i.e., the regression functions differ).
```{r}
anova(model.1)
```
Conduct an F-test to see if at least one of age.x2 and age.x3 are useful (i.e., the regression functions have different slopes).
```{r}
model.2 <- lm(y ~ age, data=depression)
anova(model.2, model.1)
```
```{r}
model.3 <- lm(y ~ age + x2 + x3, data=depression)
anova(model.3, model.1)
detach(depression) # may should not use this anymore
```



